<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>High Availability Support for GSQL Server :: TigerGraph Server User Guide</title>
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">TigerGraph Server User Guide</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="tigergraph-server" data-version="3.2">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="install.html">TigerGraph Server User Guide</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Introduction</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../intro/internal-architecture.html">TigerGraph Internal Architecture</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Getting Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/docker.html">Getting started with Docker</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Installation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="install.html">Installation Guide</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">The GSQL Shell</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../gsql-shell/using-a-remote-gsql-client.html">Using a Remote GSQL Client</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Data Definition</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-definition/README.html">Data Definition</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Data loading</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-loading/s3-loader-user-guide.html">AWS S3 Loader User Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-loading/spark-connection-via-jdbc-driver.html">Spark Connection Via JDBC Driver</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">System management</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../administration/README.html">System Management</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../administration/management-with-gadmin.html">Managing with gadmin</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Security</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/user-access/README.html">User Access Management</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Backup and Restore</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../backup-and-restore/backup-and-restore.html">Backup and Restore</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">REST API Reference</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../API/intro.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../API/built-in-endpoints.html">Built-in Endpoints</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-text">References</span>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">TigerGraph Server User Guide</span>
    <span class="version">3.2</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="install.html">TigerGraph Server User Guide</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="install.html">3.2</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../tigergraph-gui/3.2/graphstudio/overview.html">TigerGraph Web UI Guide</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../tigergraph-gui/3.2/graphstudio/overview.html">3.2</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="install.html">TigerGraph Server User Guide</a></li>
    <li><a href="ha-for-gsql-server.html">High Availability Support for GSQL Server</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/lennessyy/tg-server/edit/main/modules/installation/pages/ha-for-gsql-server.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">High Availability Support for GSQL Server</h1>
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a><strong>Introduction:</strong></h2>
<div class="sectionbody">
<div class="paragraph">
<p>By Design, TigerGraph has built-in HA for all the internal critical components from the beginning. This includes GPE, GSE, REST API Servers, etc. However, the user-facing applications (GSQL and GraphStudio) were designed to be set up by customers based on their High Availability (HA) needs. This included building solutions using non-TigerGraph components.  With 3.1 release, TigerGraph will support native HA functionality for user-facing applications as well. This simplifies and streamlines HA deployment for users completely. For Operations personnel, this will reduce the operational overhead while enhancing the availability for end users.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview_of_the_design"><a class="anchor" href="#_overview_of_the_design"></a><strong>Overview of the design:</strong></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before we elaborate the design, we need to understand the topology of how TigerGraph services are deployed in a cluster. TigerGraph nodes in a cluster are organized as &#8216;m1&#8217;, &#8216;m2&#8217;, and so on. Although all nodes in the cluster serve the same function - store data and participate in query execution, m1 is a special node. GSQL server runs on this node to address critical services such as storing client metadata as well as managing connections between client and server. With this feature, m1 will no longer serve as the only node for GSQL server connections. In the new design, other nodes will run standby GSQL servers to provide high availability for client connections.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://lh4.googleusercontent.com/pdt7MlbufmHMFuwTRX3LJev_aZjl0EgSu6XrfpNX8n2TpWSG8UFV2vS3mYSx-OO1opf_gFKCgFb3YDH6fQXMld-Zots3yApywDFBGmfFwlBVKR31bpAWdjrSmV8uegxe1WcchGFJ" alt="pdt7MlbufmHMFuwTRX3LJev aZjl0EgSu6XrfpNX8n2TpWSG8UFV2vS3mYSx OO1opf gFKCgFb3YDH6fQXMld Zots3yApywDFBGmfFwlBVKR31bpAWdjrSmV8uegxe1WcchGFJ">
</div>
</div>
<div class="sect2">
<h3 id="_role_of_primary_gsql_server"><a class="anchor" href="#_role_of_primary_gsql_server"></a><strong>Role of Primary GSQL server</strong></h3>
<div class="paragraph">
<p>In the 3.1 release, primary GSQL server will continue to perform all the tasks handled by GSQL server prior to 3.1 release. This includes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Process client connections</p>
</li>
<li>
<p>Querying requests from GSQL clients</p>
</li>
<li>
<p>User management requests including token management</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In addition to these, when Primary fails, a standby server will switch to become the Primary server, and when the old Primary server is back to normal function, it will become a GSQL Standby server.</p>
</div>
</div>
<div class="sect2">
<h3 id="_role_of_standby_gsql_servers"><a class="anchor" href="#_role_of_standby_gsql_servers"></a><strong>Role of Standby GSQL Servers</strong></h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Redirect requests to Primary Server</p>
</li>
<li>
<p>Help Primary server to check for source data file existence and parse file header (if ANY is chosen)</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_role_of_gsql_client"><a class="anchor" href="#_role_of_gsql_client"></a><strong>Role of GSQL Client</strong></h3>
<div class="paragraph">
<p>There is no change in how GSQL Client works.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_user_impact_and_changes"><a class="anchor" href="#_user_impact_and_changes"></a><strong>User Impact and Changes:</strong></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_user_source_code_maintenance"><a class="anchor" href="#_user_source_code_maintenance"></a><strong>User Source Code Maintenance</strong></h3>
<div class="paragraph">
<p>Users store the following data on m1 node that is needed for query execution:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>GSQL loader&#8217;s Token functions</p>
</li>
<li>
<p>ExprFunctions</p>
</li>
<li>
<p>ExprUtil</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is part of the user source code that TigerGraph system uses to compile. Prior to 3.1 release, this information is available to GSQL server only on m1 node. Typically, users can modify these files directly on the machine. But with HA, the Primary GSQL may not be in m1, and can be switched to any other machine at any time. Users have to make sure all the machines have the same content whenever there are updates to the files. This is a new requirement for users.</p>
</div>
<div class="paragraph">
<p>GSQL server will retrieve the User source code files in the following priority order when it needs them:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Via github/github enterprise (if configuration is set),</p>
</li>
<li>
<p>Files uploaded via PUT,</p>
</li>
<li>
<p>Default files that are shipped with the product</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_user_source_code_in_github_code_repository"><a class="anchor" href="#_user_source_code_in_github_code_repository"></a><strong>User source code in github code repository</strong></h4>
<div class="paragraph">
<p>This requires public network access, or github enterprise server access. User need to provide the following gadmin configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>GSQL.GithubUserAcessToken # the credential, or "anonymous", empty means not using github
GSQL.GithubRepository     # e.g. tigergraph/ecosys
GSQL.GithubBranch         # optional, o/w use "master" branch, e.g. demo_github
GSQL.GithubPath           # path to the directory in the github that has TokenBank.cpp, ExprFunctions.hpp, ExprUtil.hpp, e.g. sample_code/src
GSQL.GithubUrl            # optional, used for github enterprise, e.g. https://api.github.com</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Example:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>gadmin config set GSQL.GithubUserAcessToken anonymous
gadmin config set GSQL.GithubRepository tigergraph/ecosys
gadmin config set GSQL.GithubBranch demo_github
gadmin config set GSQL.GithubPath sample_code/src
gadmin config apply</pre>
</div>
</div>
<div class="paragraph">
<p>When GSQL server needs to compile the files, it will retrieve them from github if the GitHub access is configured as above. It will retry 3 times, with timeout=5s for each time. If the connection fails, it will go to the next priority level method, i.e. file uploaded via PUT.</p>
</div>
</div>
<div class="sect3">
<h4 id="_user_source_code_maintenance_for_local_files_in_the_cluster"><a class="anchor" href="#_user_source_code_maintenance_for_local_files_in_the_cluster"></a><strong>User Source code maintenance for local files in the cluster:</strong></h4>
<div class="paragraph">
<p>We are introducing new GSQL commands to address this need. These commands will allow users to upload and download the user source files.</p>
</div>
<div class="paragraph">
<p><strong>Upload source code</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>PUT TokenBank FROM "path/to/a/file"
PUT ExprFunctions FROM "path/to/a/file"
PUT ExprUtil FROM "path/to/a/file"</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Example:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>temp_TokenBank=$tempDir/tmp_TokenBank.cpp
temp_ExprFunctions=$tempDir/tmp_ExprFunctions.hpp
temp_ExprUtil=$tempDir/tmp_ExprUtil.hpp

eval gsql 'PUT TokenBank FROM \"$temp_TokenBank\"'
eval gsql 'PUT ExprFunctions FROM \"$temp_ExprFunctions\"'
eval gsql 'PUT ExprUtil FROM \"$temp_ExprUtil\"'</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Download source code</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>GET TokenBank TO "path/to/a/file"
GET ExprFunctions TO "path/to/a/file"
GET ExprUtil TO "path/to/a/file"</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Example:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>temp_TokenBank2=$tempDir/tmp_TokenBank_2.cpp
temp_ExprFunctions2=$tempDir/tmp_ExprFunctions_2.hpp
temp_ExprUtil2=$tempDir/tmp_ExprUtil_2.hpp

echo "GET TokenBank.cpp, ExprFunctions.hpp and ExprUtil.hpp to current node."

eval gsql 'GET TokenBank TO \"$temp_TokenBank2\"'
eval gsql 'GET ExprFunctions TO \"$temp_ExprFunctions2\"'
eval gsql 'GET ExprUtil TO \"$temp_ExprUtil2\"'</pre>
</div>
</div>
<div class="paragraph">
<p>The uploaded files will be saved to all nodes. Users will need to have either &#8216;superuser&#8217; and &#8216;global_designer&#8217; roles to have the sufficient privileges to run the PUT/GET commands.</p>
</div>
<div class="paragraph">
<p>When calling GET command, the user can download the corresponding file from the Primary node, to a local directory at the current cluster node.</p>
</div>
<div class="paragraph">
<p>When calling PUT command, the local file will be copied to all of the cluster nodes, including itself.</p>
</div>
<div class="paragraph">
<p><strong>Example usage scenario to update of the files is as follows:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>// Download the current file via GET, or create a new file from draft;
GET TokenBank TO "/myFolder/file.cpp"
// Upload the file via PUT
PUT TokenBank FROM "/myFolder/file.cpp"</pre>
</div>
</div>
<div class="paragraph">
<p>For each cluster node, TokenBank.cpp is stored at:</p>
</div>
<div class="listingblock">
<div class="content">
<pre> $(gadmin config get System.DataRoot)/gsql/tokenbank/</pre>
</div>
</div>
<div class="paragraph">
<p>ExprFunctions.hpp and ExprUtil.hpp files are stored at:</p>
</div>
<div class="listingblock">
<div class="content">
<pre> $(gadmin config get System.DataRoot)/gsql/udf/</pre>
</div>
</div>
<div class="paragraph">
<p>Full path should be provided including the file name for PUT/GET, eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>put ExprFunctions from "/home/path/tmp/ExprFunc.hpp"
get TokenBank to "doc/path/tmp/myTB.cpp"</pre>
</div>
</div>
<div class="paragraph">
<p>Notice that in the first command, we use absolute path, while in the second command, we use relative path. Both are supported. But &#8220;~&#8221; is not supported (eg: &#8220;~/tmp/x.hpp&#8221;).</p>
</div>
<div class="paragraph">
<p>Additionally, users can also use the commands in the following manner as well:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use a folder name, and automatically default name will be added. For example:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>put ExprFunctions from "/home/path/tmp"</pre>
</div>
</div>
<div class="paragraph">
<p>It will use ExprFunctions.hpp under the directory "/home/path/tmp" for PUT.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>get TokenBank to "home/path/tmp/"</pre>
</div>
</div>
<div class="paragraph">
<p>It will create/overwrite the file "home/path/tmp/TokenBank.cpp".</p>
</div>
<div class="paragraph">
<p>If the file name is given in the path, its file extension must be consistent with the corresponding file. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>put ExprFunctions from "/home/path/tmp/test1.gsql"</pre>
</div>
</div>
<div class="paragraph">
<p>is not allowed, since PUT/GET ExprFunctions must use &#8220;.hpp&#8221; as file extension.</p>
</div>
</div>
<div class="sect3">
<h4 id="_default_file_shipped_with_tigergraph_package"><a class="anchor" href="#_default_file_shipped_with_tigergraph_package"></a><strong>Default file shipped with TigerGraph package</strong></h4>
<div class="paragraph">
<p>If the corresponding file is not found, the GSQL Primary server will use the default file in the package. These default files are at:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$(gadmin config get System.AppRoot)/dev/gdk/gsql/src/TokenBank/TokenBank.cpp
$(gadmin config get System.AppRoot)/dev/gdk/gsql/src/QueryUdf/ExprUtil.hpp
$(gadmin config get System.AppRoot)/dev/gdk/gsql/src/QueryUdf/ExprFunctions.hpp</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_file_path_configuration"><a class="anchor" href="#_file_path_configuration"></a><strong>File Path Configuration</strong></h3>
<div class="paragraph">
<p>In Pre-3.1 release design, the file path used in loading jobs refers to the file in m1, unless the user specifies machine name before the path (ALL, ANY, m1, m2,&#8230;&#8203;). In the new HA design, the Primary server can be running on any machine, and can be switched. This means GSQL server may or may not find the file. To be back-compatible we prefix a machine name if the client is in TigerGraph cluster.</p>
</div>
<div class="paragraph">
<p>Users can specify the node ID before the path using: ALL, ANY, m1, m2 and so forth. Declaring ALL or ANY as host ID will load files from every cluster node.</p>
</div>
<div class="paragraph">
<p>User can use form like &#8220;m1|m3|m4&#8221; to declare the combination of several nodes.</p>
</div>
<div class="paragraph">
<p>If the hosts are not specified, it will look for the host ID of the current node that is running the loading job, (through searching the nodes in $(gadmin config get GSQL.BasicConfig.Nodes)). If not found, it will use node &#8220;m1&#8221; by default.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># current refers to /path/to/csv in m1
LOAD "/path/to/csv" TO VERTEX vt VALUES($0)
LOAD "ALL:/path/to/csv" TO VERTEX vt VALUES($0)
LOAD "m1|m2:/path/to/csv" TO VERTEX vt VALUES($0)</pre>
</div>
</div>
<div class="paragraph">
<p>Data source can be created and used with a file path or a JSON string, same as above.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>create data_source kafka k1 for graph poc_graph
set k1 = "/tmp/kafka_config.json"
create data_source kafka k2 = "/tmp/kafka_config.json"

CREATE LOADING JOB load_kafka FOR GRAPH poc_graph {
  DEFINE FILENAME f1 = "$k1:/tmp/topic_partition_config.json";
  LOAD f1
      TO VERTEX MyNode VALUES ($2)
      USING SEPARATOR="|";
}</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_gsql_client_connection_setup"><a class="anchor" href="#_gsql_client_connection_setup"></a><strong>GSQL Client connection setup:</strong></h3>
<div class="paragraph">
<p>GSQL client can connect to GSQL server in the different ways with the following priority order:</p>
</div>
<div class="sect3">
<h4 id="_using_ip_address"><a class="anchor" href="#_using_ip_address"></a><strong>Using IP address:</strong></h4>
<div class="paragraph">
<p>Users can specify the ip and port when calling GSQL client using &#8220;gsql -i&#8221; or &#8220;gsql -ip&#8221;. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gsql -ip 192.168.11.32:14240,192.168.11.34:14240,192.168.11.36</pre>
</div>
</div>
<div class="paragraph">
<p>GSQL clients will try these ips and ports one by one. Notice the port is optional, it will use 14240 by default, which is the default port for GSQL server.</p>
</div>
</div>
<div class="sect3">
<h4 id="_using_gsql_ip_configuration"><a class="anchor" href="#_using_gsql_ip_configuration"></a><strong>Using GSQL IP Configuration:</strong></h4>
<div class="paragraph">
<p>If &#8220;gsql -i&#8221; or &#8220;gsql -ip&#8221; are not used, GSQL client will search the file gsql_server_ip_config where the user runs the GSQL client. The file gsql_server_ip_config should be a one-line file such as shown below. GSQL client will traverse the ips and ports in the file in its order.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>172.18.0.101,172.18.0.102:14240,172.18.0.103:14240</pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, the port number is also optional, using 14240 by default.</p>
</div>
</div>
<div class="sect3">
<h4 id="_using_default_local_server"><a class="anchor" href="#_using_default_local_server"></a><strong>Using default local server:</strong></h4>
<div class="paragraph">
<p>If  &#8220;gsql -i&#8221; or &#8220;gsql -ip&#8221; are not used, and the file gsql_server_ip_config does not exist where &#8220;gsql&#8221; is called, GSQL client will try to connect to the local server (127.0.0.1:8123).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_setting_gsql_ha_configuration"><a class="anchor" href="#_setting_gsql_ha_configuration"></a><strong>Setting GSQL HA Configuration</strong></h3>
<div class="paragraph">
<p>Use gadmin config to get/set the following configurations related to GSQL High Availability.</p>
</div>
<div class="paragraph">
<p>The first is the heartbeat interval in milliseconds. The second (&#8220;max misses&#8221;) is the total timeout for switching to the Primary server which will measure the number of heartbeat intervals. It must be at least 2 to allow 1 heartbeat miss.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Controller.LeaderElectionHeartBeatIntervalMS = 2000
Controller.LeaderElectionHeartBeatMaxMiss = 4</pre>
</div>
</div>
<div class="paragraph">
<p>For example, if we use &#8220;IntervalMS = 2000&#8221; and &#8220;max misses = 4&#8221; as shown above, then the total timeout is 2s×4 = 8 seconds. So the current Primary server will be switched if its heartbeat has stopped for more than 8 seconds.<br>
<em>**</em></p>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
