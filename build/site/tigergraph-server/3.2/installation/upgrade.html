<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Upgrading an Existing Installation :: TigerGraph Server User Guide</title>
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">TigerGraph Server User Guide</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="tigergraph-server" data-version="3.2">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="install.html">TigerGraph Server User Guide</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Introduction</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../intro/internal-architecture.html">TigerGraph Internal Architecture</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Getting Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/docker.html">Getting started with Docker</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Installation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="install.html">Installation Guide</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">The GSQL Shell</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../gsql-shell/using-a-remote-gsql-client.html">Using a Remote GSQL Client</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Data Definition</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-definition/README.html">Data Definition</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Data loading</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-loading/s3-loader-user-guide.html">AWS S3 Loader User Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-loading/spark-connection-via-jdbc-driver.html">Spark Connection Via JDBC Driver</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">System management</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../administration/README.html">System Management</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../administration/management-with-gadmin.html">Managing with gadmin</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Security</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/user-access/README.html">User Access Management</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Backup and Restore</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../backup-and-restore/backup-and-restore.html">Backup and Restore</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">REST API Reference</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../API/intro.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../API/built-in-endpoints.html">Built-in Endpoints</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-text">References</span>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">TigerGraph Server User Guide</span>
    <span class="version">3.2</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="install.html">TigerGraph Server User Guide</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="install.html">3.2</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../tigergraph-gui/3.2/graphstudio/overview.html">TigerGraph Web UI Guide</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../tigergraph-gui/3.2/graphstudio/overview.html">3.2</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="install.html">TigerGraph Server User Guide</a></li>
    <li><a href="upgrade.html">Upgrading an Existing Installation</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/lennessyy/tg-server/edit/main/modules/installation/pages/upgrade.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Upgrading an Existing Installation</h1>
<div class="sect1">
<h2 id="_upgrading_from_v3_x_to_v3_x"><a class="anchor" href="#_upgrading_from_v3_x_to_v3_x"></a>Upgrading from v3.x to v3.x</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Any 3.x version of TigerGraph can up upgraded to another v3.x version by running the installation script with the upgrade(<code>-U</code>) flag.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download the latest version of TigerGraph to your system.</p>
</li>
<li>
<p>Extract the tarball.</p>
</li>
<li>
<p>Run the install script under the Linux user created during installation with the upgrade flag (<code>-U</code>)  that was extracted from the tarball:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./install.sh -U</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_previous_versions"><a class="anchor" href="#_previous_versions"></a>Previous Versions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In-place cluster migration of schema and data is an important aspect of business continuity. TigerGraph supports full migration between compatible versions through simple upgrade operations. However, there are some special considerations when migrating to TigerGraph 3.0 version as noted below.</p>
</div>
<div class="paragraph">
<p>{% hint style="danger" %}</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Please contact TigerGraph Support to coordinate migration to TigerGraph 3.0 version. Even though all the steps for Migration are documented on this page, it is strongly recommended that you review the migration process with TigerGraph Support team</p>
</li>
<li>
<p>Migration from pre-3.0 versions (TigerGraph 2.4, 2.5 and 2.6 ) to 3.0 is supported. To migrate from versions prior to 2.4, users are advised to contact TigerGraph Support to check the feasibility of support the range of earlier versions.</p>
</li>
<li>
<p>Please be sure to take a backup of data on the cluster before starting the migration process.
{% endhint %}</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>{% hint style="danger" %}
Developer Edition upgrade is not supported</p>
</div>
<div class="paragraph">
<p>The Developer Edition is not designed for upgrades from one version to another<br>
It is not possible to upgrade a Developer Edition installation to Enterprise Edition.
{% endhint %}</p>
</div>
<div class="paragraph">
<p>{% hint style="warning" %}
If you have written User-Defined Functions for your queries, be sure to make a backup of these files :<br>
<code>&lt;tigergraph.root.dir&gt;/app/&lt;VERSION_NUM&gt;/dev/gdk/gsql/src/QueryUdf/ExprFunctions.hpp</code></p>
</div>
<div class="paragraph">
<p><code>&lt;tigergraph.root.dir&gt;/app/&lt;VERSION_NUM&gt;/dev/gdk/gsql/src/QueryUdf/ExprUtil.hpp</code>
{% endhint %}</p>
</div>
<div class="sect2">
<h3 id="_upgrading_from_v2_x_to_v3_x"><a class="anchor" href="#_upgrading_from_v2_x_to_v3_x"></a>Upgrading from v2.x to v3.x</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure all in-memory graph updates are persisted to disk data by running the <a href="../../../dev/restpp-api/built-in-endpoints.md#rebuild-graph-engine"><code>/rebuildnow</code> endpoint</a> and no active jobs are running. For graphs requiring an authentication token, the endpoint must be called for each graph utilizing their respective tokens. For graphs not requiring tokens, you can call the endpoint once for all graphs. The <code>/rebuildnow</code> endpoint does not guarantee that all KAFKA messages are consumed by the engine (you have to wait until there is no PullDelta in the GPE log to guarantee that all KAFKA messages have been consumed by the engine). It only guarantees that all the in-memory graph updates are persisted to disk data.</p>
</li>
<li>
<p>Make sure config is applied by using this command : <code>gadmin config-apply</code>.</p>
</li>
<li>
<p>Stop your TigerGraph system with this command : <code>gadmin stop all admin ts3 -y</code>.</p>
</li>
<li>
<p>Install version 3.0.0 with the same cluster config and HA options as your previous installation.</p>
<div class="ulist">
<ul>
<li>
<p>If you have enabled HA in your 2.5.x installation, you should specify the ReplicationFactor in 3.0.0 installer to be the same as previously configured. Otherwise, leave it as 1.</p>
</li>
<li>
<p><strong>NOTE: If your old 2.5.x system is installed in the cluster [m1, m2, m3, m4], you could only install 3.0.0 in the same [m1, m2, m3, m4], but you only need to maintain the IP of m1 to be the same. The order of m2 to m4 does not matter.</strong></p>
</li>
<li>
<p>Please specify a valid license key.</p>
</li>
</ul>
</div>
</li>
<li>
<p>After installing, log in as user <code>tigergraph</code>. Now <code>gadmin version</code> should point to 3.0.0. If not, please check your installation. <em>**</em></p>
</li>
<li>
<p><strong>For the following instructions, we assume to be under tigergraph user:</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Migration process instructions are documented in <a href="https://tigergraph.freshdesk.com/support/solutions/articles/5000859240-2-x-to-3-0-0-upgrade-flow" class="bare">https://tigergraph.freshdesk.com/support/solutions/articles/5000859240-2-x-to-3-0-0-upgrade-flow</a></p>
</li>
<li>
<p>If any errors occur, please check the error message, as well as debug.log under the migration tool folder.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>{% hint style="warning" %}
Notice: If you don&#8217;t activate a valid license when installing 3.0, you might fail in the end when running these two commands.<br>
<code>gsql recompile loading job
gsql install query -force all</code>
{% endhint %}</p>
</div>
</div>
<div class="sect2">
<h3 id="_upgrading_from_2_x_to_2_x"><a class="anchor" href="#_upgrading_from_2_x_to_2_x"></a>Upgrading from 2.x to 2.x</h3>
<div class="paragraph">
<p>All sections below are for versions prior to v3.0.<br>
If your specific versions are not listed below, please upgrade by :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download the latest version of TigerGraph to your system.</p>
</li>
<li>
<p>Extract the tarball.</p>
</li>
<li>
<p>Run the TigerGraph.bin file that was extracted from the tarball : <code>bash tigergraph.bin</code></p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_upgrading_from_v2_1_7_to_v2_2_x"><a class="anchor" href="#_upgrading_from_v2_1_7_to_v2_2_x"></a>Upgrading from v2.1.7 to v2.2.x <a id="updating-from-v-2-1-7-to-v-2-2-5"></a></h3>
<div class="paragraph">
<p>These steps are assuming that v2.1.7 is installed. To upgrade to v2.2 from a version older than v2.1.7, please upgrade to v2.1.7 first. If the tigergraph username and password have been changed, please have them ready as you will need them in order to update the system.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download tigergraph-2.2.x-offline.tar.gz with user &#8220;tigergraph&#8221; and extract the tarball file.</p>
</li>
<li>
<p>Download the <code>post_upgrade.sh</code> script that is attached <a href="https://tigergraph.freshdesk.com/support/solutions/articles/5000810844-v2-1-7-v2-2-x-upgrade-instructions">here</a>.</p>
</li>
<li>
<p>Run tigergraph.bin under the same folder to upgrade to 2.2.x</p>
</li>
<li>
<p>Run the post-upgrade script that was downloaded in step 2 : <strong>post_upgrade.sh</strong> -u &lt;sudoUser&gt; [-P &lt;sudoPass&gt; | -K &lt;sshKey&gt; ] -p &lt;tigergraphUserPass&gt;</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_upgrading_from_v2_0_to_v2_1"><a class="anchor" href="#_upgrading_from_v2_0_to_v2_1"></a>Upgrading from v2.0 to v2.1</h3>
<div class="paragraph">
<p>v2.0 can be upgraded to v2.1 Enterprise Edition. The data store format and GSQL language scripts in v2.0 are forward compatible with v2.1.</p>
</div>
</div>
<div class="sect2">
<h3 id="_upgrading_from_v1_x_to_v2_x"><a class="anchor" href="#_upgrading_from_v1_x_to_v2_x"></a>Upgrading from v1.x to v2.x</h3>
<div class="paragraph">
<p>The data store format between 1.x and 2.x for single servers is forward compatible but not backward compatible. For a single server platform, users can upgrade from 1.x to 2.x without reloading data or recreating the graph schema. Some details of the GSQL language have changed, so some loading jobs and queries will need to be revised and reinstalled.</p>
</div>
<div class="paragraph">
<p>For a cluster configuration, a direct upgrade from 1.x to 2.x is not supported at this time.  Users interested in migrating from 1.x to 2.x need to export their data and metadata, install v2.x, and then reload data and metadata, with some small modifications.  Please contact <a href="mailto:support@tigergraph.com">support@tigergraph.com</a>for assistance.</p>
</div>
<div class="paragraph">
<p>Please consult the Release Notes for all the versions between your current version and your target version (e.g., v2.1) to see a summary of specification changes.  Contain <a href="mailto:support@tigergraph.com">support@tigergraph.com</a>for assistance.</p>
</div>
</div>
<div class="sect2">
<h3 id="_workflow_for_direct_upgrade"><a class="anchor" href="#_workflow_for_direct_upgrade"></a>Workflow for Direct Upgrade</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Verify that your datastore is compatible and is eligible for direct update/upgrade.</p>
</li>
<li>
<p>Review the specification changes and how they may affect your applications (loading jobs and queries).</p>
</li>
<li>
<p>Stop issuing new commands to your TigerGraph system and allow any operations to complete.</p>
</li>
<li>
<p>(Recommended) Back up your data, as a precaution.</p>
</li>
<li>
<p>Follow the procedure at the beginning of this document for installing a new system.  The installer will automatically shut down your system and start it again.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>{% hint style="danger" %}
 Be sure to specify the same username as your current installation. Otherwise, if you use a different user name, it will be treated as a new installation, with an empty graph.
{% endhint %}</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Pay attention to output messages during the installation process which may alert you to additional tasks or checks you should perform.</p>
</li>
<li>
<p>Run the command <strong>gsql</strong> to start the GSQL shell. The first time after an update, gsql performs two important operations:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Copies your catalog from your old installation to the new installation.</p>
</li>
<li>
<p>Compares the files in the backup <code>/dev_&lt;datetime&gt;/gdk/gsql/src</code> folder to the new <code>/dev/gdk/gsql/src</code> folder. Pay attention to any files residing in the old folder but not in the new folder.  Review them and copy them to the new folder if appropriate.  See the example below.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Revise and reinstall loading jobs, user-defined functions, and queries as needed.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
