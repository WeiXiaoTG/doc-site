<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Disaster Recovery Support :: TigerGraph Server User Guide</title>
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">TigerGraph Server User Guide</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="tigergraph-server" data-version="3.2">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="install.html">TigerGraph Server User Guide</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Introduction</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../intro/internal-architecture.html">TigerGraph Internal Architecture</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Getting Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/docker.html">Getting started with Docker</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Installation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="install.html">Installation Guide</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">The GSQL Shell</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../gsql-shell/using-a-remote-gsql-client.html">Using a Remote GSQL Client</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Data Definition</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-definition/README.html">Data Definition</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Data loading</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-loading/s3-loader-user-guide.html">AWS S3 Loader User Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-loading/spark-connection-via-jdbc-driver.html">Spark Connection Via JDBC Driver</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">System management</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../administration/README.html">System Management</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../administration/management-with-gadmin.html">Managing with gadmin</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Security</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/user-access/README.html">User Access Management</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Backup and Restore</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../backup-and-restore/backup-and-restore.html">Backup and Restore</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">REST API Reference</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../API/intro.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../API/built-in-endpoints.html">Built-in Endpoints</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-text">References</span>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">TigerGraph Server User Guide</span>
    <span class="version">3.2</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="install.html">TigerGraph Server User Guide</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="install.html">3.2</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../tigergraph-gui/3.2/graphstudio/overview.html">TigerGraph Web UI Guide</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../tigergraph-gui/3.2/graphstudio/overview.html">3.2</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="install.html">TigerGraph Server User Guide</a></li>
    <li><a href="disaster-recovery-support.html">Disaster Recovery Support</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/lennessyy/tg-server/edit/main/modules/installation/pages/disaster-recovery-support.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Disaster Recovery Support</h1>
<div class="sect1">
<h2 id="_overview"><a class="anchor" href="#_overview"></a><strong>Overview</strong></h2>
<div class="sectionbody">
<div class="paragraph">
<p>TigerGraph architecture is built with no Single Point of Failure (SPOF). This provides fault tolerance built at each component level. Any component or server failure is handled seamlessly by TigerGraph&#8217;s Continuous Availability.</p>
</div>
<div class="paragraph">
<p>However, there are situations where the failures span the entire cluster due to loss of data center or any other catastrophic event, Continuous Availability will not be sufficient. Typically, such an event would be defined as a Disaster. Customers would need a disaster recovery (DR) plan to get services back up in the event of a disaster.</p>
</div>
<div class="paragraph">
<p>Cross-Region Replication (CRR) is a new feature that will allow users to keep two or more TigerGraph clusters in different data centers or regions in sync.</p>
</div>
<div class="paragraph">
<p>For customers, cross-region replication will help deliver on the following business goals:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Disaster Recovery</strong>: Support Disaster Recovery functionality with the use of a dedicated remote cluster</p>
</li>
<li>
<p><strong>Enhanced Availability</strong>: Enhance Inter-cluster data availability by synchronizing data using Read Replicas across two clusters</p>
</li>
<li>
<p><strong>Enhanced Performance</strong>: If the customer application is spread over different regions, CRR can take advantage of data locality to avoid network latency.</p>
</li>
<li>
<p><strong>Improved System Load-balancing</strong>: CRR allows you to distribute computation load evenly across two clusters if the same data sets are accessed in both clusters.</p>
</li>
<li>
<p><strong>Data Residency Compliance</strong>: Cross-Region replication allows you to replicate data between different data centers or Regions to satisfy compliance requirements. Additionally, this feature can be used to set up clusters in the same region to satisfy more stringent Data sovereignty or localization business requirements.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Besides Disaster recovery and enhanced business continuity, this will enable forward-thinking customers to set up the clusters as part of Blue/Green deployment purposes for agile upgrades.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_design"><a class="anchor" href="#_design"></a><strong>Design</strong></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Disaster Recovery support will include complete native support for all Data and Metadata replication including Automated schema changes, User management, and Query management.</p>
</div>
<div class="paragraph">
<p>Cross-region replication will be delivered in two phases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Phase1</strong>: Cross-region replication support for data from Primary to DR cluster. Metadata operations will not be supported. Phase 1 will be delivered in TigerGraph 3.1.</p>
</li>
<li>
<p><strong>Phase2</strong>: Complete native support for all Data and Metadata replication including Automated schema changes, User and Query management. Phase 2 will be delivered in TigerGraph 3.2.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="https://lh5.googleusercontent.com/rfYwJYgfd2jHPJoBSgGy_ZoPc7DGnbE5VxHlBTaRFuAz2yFxPTzCF1kmha9VCuq2ZQQw5PZcFF6l07hJ-Oc1Nb2RN0j3ZtOjcGVwaCB07U63VAMCqWROG98iJE0KovUg5-_PTx2L" alt="rfYwJYgfd2jHPJoBSgGy ZoPc7DGnbE5VxHlBTaRFuAz2yFxPTzCF1kmha9VCuq2ZQQw5PZcFF6l07hJ Oc1Nb2RN0j3ZtOjcGVwaCB07U63VAMCqWROG98iJE0KovUg5  PTx2L">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_user_impact_and_changes"><a class="anchor" href="#_user_impact_and_changes"></a><strong>User Impact and Changes</strong></h2>
<div class="sectionbody">
<div class="paragraph">
<p>To support cross-region replication, primary and standby clusters need to have the same number of partitions. However, the clusters can have different numbers of replicas. Also, the clusters can be in the same region or data center.</p>
</div>
<div class="paragraph">
<p>The following setup is needed in order to perform a failover in the event of a disaster:</p>
</div>
<div class="sect2">
<h3 id="_primary_cluster_setup"><a class="anchor" href="#_primary_cluster_setup"></a><strong>Primary cluster setup</strong></h3>
<div class="paragraph">
<p>There are no configuration changes required for the primary cluster. This feature is designed not to impact the primary cluster operations in any way. However, the primary cluster should be running on TigerGraph Version 3.1.</p>
</div>
</div>
<div class="sect2">
<h3 id="_dr_cluster_setup"><a class="anchor" href="#_dr_cluster_setup"></a><strong>DR cluster setup</strong></h3>
<div class="paragraph">
<p>The remote cluster needs to be set up to be used as a Disaster Recovery cluster. The following configurations should be set up by the operations team to enable the synchronization of data between primary and remote clusters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gadmin config set System.CrossRegionReplication.Enabled true
gadmin config set System.CrossRegionReplication.PrimaryKafkaIPs &lt;primary_ips&gt; // IP lists, comma separated
gadmin config set System.CrossRegionReplication.PrimaryKafkaPort &lt;kafka_port&gt;
gadmin config set System.CrossRegionReplication.GpeTopicPrefix Primary
gadmin config apply -y
gadmin init kafka -y
gadmin restart -y</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_metadata_operations"><a class="anchor" href="#_metadata_operations"></a><strong>Metadata Operations</strong></h3>
<div class="paragraph">
<p>All the data loaded in the Primary cluster will be copied and loaded into the DR cluster automatically. In TigerGraph 3.1, users will also have to manually perform all the metadata operations. The Metadata operations include Schema change, Installation of new queries, and User Management operations.</p>
</div>
<div class="paragraph">
<p>With respect to Schema change, users will have to perform all the Schema change operations on the DR cluster in the same order after successfully applying schema change in the primary cluster. Without applying the corresponding schema change in the DR clusters, data updates will pause in the DR clusters. Or if wrong schema change (or wrong order) is performed in the DR cluster, there will be data inconsistency issues resulting in loss of cluster services.</p>
</div>
</div>
<div class="sect2">
<h3 id="_failover"><a class="anchor" href="#_failover"></a><strong>Failover</strong></h3>
<div class="paragraph">
<p>In the event of catastrophic failure that has impacted the full cluster due to Data Center or Region failure, the customer can initiate the failover to the DR cluster. This is a manual process. Users will have to make the following configuration changes to upgrade the DR cluster to become the primary cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gadmin config set System.CrossRegionReplication.Enabled false
gadmin config set System.CrossRegionReplication.PrimaryKafkaIPs
gadmin config set System.CrossRegionReplication.PrimaryKafkaPort
gadmin config set System.CrossRegionReplication.GpeTopicPrefix Primary
gadmin config apply -y
gadmin restart -y</pre>
</div>
</div>
<div class="paragraph">
<p>If we want to set up a new DR cluster over the upgraded primary cluster:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gadmin config set System.CrossRegionReplication.Enabled true
gadmin config set System.CrossRegionReplication.PrimaryKafkaIPs &lt;primary_ips&gt; // IP lists, comma separated
gadmin config set System.CrossRegionReplication.PrimaryKafkaPort &lt;kafka_port&gt;
gadmin config set System.CrossRegionReplication.GpeTopicPrefix Primary.Primary // Yes P.P
gadmin config apply -y
gadmin init kafka -y
gadmin restart -y</pre>
</div>
</div>
<div class="paragraph">
<p>There is no limit on the number of times a cluster can failover to another cluster. When designating a new DR cluster, make sure that you set the <code>System.CrossRegionReplication.GpeTopicPrefix</code> parameter correctly by adding an additional <code>.Primary</code> . For example, if your original cluster fails over once, and the current cluster&#8217;s <code>GpeTopicPrefix</code> is <code>Primary</code>, then the new DR cluster needs to have its <code>GpeTopicPrefix</code> be <code>Primary.Primary</code>. If it needs to fail over again, the new DR cluster needs to have its <code>GpeTopicPrefix</code> be set to <code>Primary.Primary.Primary</code>.</p>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
