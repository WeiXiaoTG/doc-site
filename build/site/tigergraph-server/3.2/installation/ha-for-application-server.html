<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>High Availability Support for Application Server :: TigerGraph Documentation</title>
    <meta name="generator" content="Antora 3.0.0-alpha.8">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">TigerGraph Documentation</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="tigergraph-server" data-version="3.2">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="install.html">TigerGraph Server User Guide</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Introduction</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../intro/internal-architecture.html">TigerGraph Internal Architecture</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Getting Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/docker.html">Getting started with Docker</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Get started with cloud images</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting-started/cloud-images/aws.html">Get Started on AWS</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Installation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="install.html">Installation Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="upgrade.html">Upgrade Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="uninstallation.html">Uninstallation</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">The GSQL Shell</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../gsql-shell/using-a-remote-gsql-client.html">Using a Remote GSQL Client</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Data Definition</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-definition/README.html">Data Definition</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Data loading</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-loading/s3-loader-user-guide.html">AWS S3 Loader User Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-loading/spark-connection-via-jdbc-driver.html">Spark Connection Via JDBC Driver</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">System management</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../administration/README.html">System Management</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../administration/management-with-gadmin.html">Managing with gadmin</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Security</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/user-access/README.html">User Access Management</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Backup and Restore</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../backup-and-restore/backup-and-restore.html">Backup and Restore</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">REST API Reference</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../API/intro.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../API/built-in-endpoints.html">Built-in Endpoints</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-text">References</span>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">TigerGraph Server User Guide</span>
    <span class="version">3.2</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../gsql-ref/3.2/intro/intro.html">GSQL Language Reference</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../gsql-ref/3.2/intro/intro.html">3.2</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../tigergraph-cloud/latest/start/README.html">TigerGraph Cloud</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../tigergraph-cloud/latest/start/README.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../tigergraph-data-science/3.2/intro/overview.html">TigerGraph Data Science Library</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../tigergraph-data-science/3.2/intro/overview.html">3.2</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="install.html">TigerGraph Server User Guide</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="install.html">3.2</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../tigergraph-gui/3.2/graphstudio/overview.html">TigerGraph Web UI Guide</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../tigergraph-gui/3.2/graphstudio/overview.html">3.2</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="install.html">TigerGraph Server User Guide</a></li>
    <li><a href="ha-for-application-server.html">High Availability Support for Application Server</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/lennessyy/tg-server/edit/main/modules/installation/pages/ha-for-application-server.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">High Availability Support for Application Server</h1>
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By Design, TigerGraph has built-in HA for all the internal critical components from the beginning. This includes GPE, GSE, REST API Servers, etc. However, the user-facing applications (GSQL, GraphStudio and Admin Portal) were designed to be set up by customers based on their High Availability (HA) needs. This included building solutions using non-TigerGraph components. With 3.1 release, TigerGraph will support native HA functionality for user-facing applications as well. This simplifies and streamlines HA deployment for users completely. For Operations personnel, this will reduce the operational overhead while enhancing the availability for end users.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview_of_the_design"><a class="anchor" href="#_overview_of_the_design"></a><strong>Overview of the design</strong></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before we elaborate the design, we need to understand the topology of how TigerGraph services are deployed in a cluster. TigerGraph nodes in a cluster are organized as &#8216;m1&#8217;, &#8216;m2&#8217;, and so on. Application Server (which serve the APIs for GraphStudio and Admin Portal) follows the active-active architecture, in which the server is always on m1 and all replicas of m1. This system is a network of independent processing nodes, each having access to a replicated database such that all nodes can provide a similar set of functionalities. With this feature, users can connect to any of the nodes that runs Application Server to get access to GraphStudio and Admin Portal.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../.gitbook/assets/diagram-draft-1-.svg" alt="diagram draft 1 ">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_user_impacts"><a class="anchor" href="#_user_impacts"></a><strong>User Impacts</strong></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_when_a_server_dies"><a class="anchor" href="#_when_a_server_dies"></a><strong>When a server dies</strong></h3>
<div class="paragraph">
<p>When a server dies, users can proceed to the next available server within the cluster to resume the operations. For example, assuming the TigerGraph cluster has Application Server on m1 and m2. If the server on m1 dies, users can access m2 to use GraphStudio and Admin Portal.</p>
</div>
<div class="paragraph">
<p>Keep in mind that any long running operation that is currently in process when the server dies will be lost.</p>
</div>
</div>
<div class="sect2">
<h3 id="_load_balancing"><a class="anchor" href="#_load_balancing"></a>Load Balancing</h3>
<div class="sect3">
<h4 id="_nginx"><a class="anchor" href="#_nginx"></a>NGINX</h4>
<div class="paragraph">
<p>One possible choice for setting up load balancing is through the use of NGINX.</p>
</div>
<div class="paragraph">
<p>Here is an example NGINX configuration for the upstream and server directives:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">    upstream flask_pool {
        ip_hash;
        zone flask_pool 64k;
        server 172.31.86.19:14240;
        server 172.31.88.70:14240;
        server 172.31.94.90:14240;

        keepalive 32;
    }

    server {
        listen      8000;
        server_name localhost;

        location / {
                root html;
                index index.html index.htm;
                proxy_pass http://flask_pool;
                proxy_read_timeout 3600;
                proxy_set_header Connection "";
                proxy_http_version 1.1;
                chunked_transfer_encoding off;
                proxy_buffering off;
                proxy_cache off;
        }
        error_page 500 502 503 504 /50x.html;
        location = /50x.html {
                root html;
        }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The server directives should specify your nodes' addresses which you want to load balance. Since TigerGraph requires session persistence, the load balancing methods will be limited to <em>ip_hash</em> or <em>hash</em>, unless you have access to NGINX Plus, which then means any load balancing method may be used with session persistence setup: <a href="https://docs.nginx.com/nginx/admin-guide/load-balancer/http-load-balancer/#sticky" class="bare">https://docs.nginx.com/nginx/admin-guide/load-balancer/http-load-balancer/#sticky</a></p>
</div>
<div class="paragraph">
<p>An active health check can be set on the following endpoint if using NGINX Plus:</p>
</div>
<div class="paragraph">
<p><code>/api/ping</code></p>
</div>
<div class="paragraph">
<p>Otherwise, only a passive health check is available. See NGINX documentation for more information: <a href="https://docs.nginx.com/nginx/admin-guide/load-balancer/http-health-check/" class="bare">https://docs.nginx.com/nginx/admin-guide/load-balancer/http-health-check/</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_aws_elastic_load_balancing"><a class="anchor" href="#_aws_elastic_load_balancing"></a>AWS Elastic Load Balancing</h3>
<div class="paragraph">
<p>Another choice for load balancing is through the use of an Application Load Balancer with AWS: <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/create-application-load-balancer.html">https://docs.aws.amazon.com/elasticloadbalancing/latest/application/introduction.html</a></p>
</div>
<div class="paragraph">
<p>In addition to the outlined AWS step 1 to step 6 on the following page: <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/create-application-load-balancer.html" class="bare">https://docs.aws.amazon.com/elasticloadbalancing/latest/application/create-application-load-balancer.html</a></p>
</div>
<div class="paragraph">
<p>You should also use the following details in step 3, 4, 5:</p>
</div>
<div class="paragraph">
<p>Step 3: When creating or using an existing security group, make sure it allows requests from the load balancer to port 14240 of the instances in the target group. You can see AWS&#8217;s recommended rules here: <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-update-security-groups.html" class="bare">https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-update-security-groups.html</a></p>
</div>
<div class="paragraph">
<p>Step 4: Set the health check URL to <code>/api/ping</code></p>
</div>
<div class="paragraph">
<p>Step 5: Enter 14240 for the port of your instances.</p>
</div>
<div class="paragraph">
<p>After following the steps and creating your load balancer, we need to enable sticky sessions in your target group: <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/sticky-sessions.html" class="bare">https://docs.aws.amazon.com/elasticloadbalancing/latest/application/sticky-sessions.html</a></p>
</div>
<div class="paragraph">
<p>After successfully creating your load balancer, you should now be able to access GraphStudio through the load balancer&#8217;s DNS name. The DNS name can be found under the "Description" tab of your load balancer in the Amazon EC2 console.</p>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
