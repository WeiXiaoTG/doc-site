<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vertex-Level Access Control (Beta) :: TigerGraph Documentation</title>
    <meta name="generator" content="Antora 3.0.0-alpha.8">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">TigerGraph Documentation</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="tigergraph-server" data-version="3.2">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../intro/introduction.html">TigerGraph Server</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../intro/introduction.html">Introduction</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../intro/internal-architecture.html">Internal Architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../intro/multigraph-overview.html">Multigraph Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../intro/transaction-and-acid.html">Transaction Processing and ACID Support</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../intro/comparison-of-editions.html">Comparing TigerGraph Editions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../intro/continuous-availability-overview.html">Continuous Availability Overview</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Getting Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/docker.html">Get started with Docker</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Get started with cloud images</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting-started/cloud-images/aws.html">Get Started on AWS</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting-started/cloud-images/azure.html">Get Started on Microsoft Azure</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting-started/cloud-images/gcp.html">Get Started on Google Cloud</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/linux.html">Install TigerGraph on Linux</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Installation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/hw-and-sw-requirements.html">Hardware and Software Requirements</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/install.html">Installlation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/upgrade.html">Upgrade</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/uninstallation.html">Uninstallation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/license.html">Advanced License Issues</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../gsql-shell/gsql-shell.html">The GSQL Shell</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../gsql-shell/using-a-remote-gsql-client.html">Using a Remote GSQL Client</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="README.html">User Access Management</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="enabling-user-authentication.html">Enabling User Authentication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="managing-credentials.html">Managing Credentials</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="roles-and-privileges.html">Roles and Privileges</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="role-management.html">Role Management</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="user-management.html">User Management</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="vlac.html">Vertex-Level Access Control (Beta)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="sso.html">Single Sign-On</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ldap.html">Lightweight Directory Access Protocol (LDAP)</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">High Availability</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../ha/ha-cluster.html">HA Cluster Configuration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../ha/ha-for-gsql-server.html">High Availability Support for GSQL Server</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../ha/ha-for-application-server.html">High Availability Support for Application Server</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../ha/cluster-commands.html">Cluster Commands</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../cluster-resizing/README.html">Cluster Resizing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cluster-resizing/expand-a-cluster.html">Cluster Expansion</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cluster-resizing/shrink-a-cluster.html">Cluster Shrinking</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cluster-resizing/repartition-a-cluster.html">Cluster Repartition</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../crr/cross-region-replication.html">Cross-Region Replication</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../kubernetes/README.html">Kubernetes</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kubernetes/quickstart-with-docker-desktop.html">Quickstart with Docker Desktop</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kubernetes/quickstart-with-eks.html">Quickstart with EKS</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kubernetes/quickstart-with-aks.html">Quickstart with AKS</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kubernetes/quickstart-with-gke.html">Quickstart with GKE</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../data-definition/README.html">Database Definition</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../data-loading/README.html">Data Loading</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-loading/s3-loader-user-guide.html">AWS S3 Loader User Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-loading/kafka-loader-user-guide.html">Kafka Loader User Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-loading/spark-connection-via-jdbc-driver.html">Spark Connection Via JDBC Driver</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../data-querying/README.html">Querying</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../gadmin/management-with-gadmin.html">Managing with gadmin</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Security</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/encrypting-connections.html">Encrypting Connections</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/encrypting-data-at-rest.html">Encrypting Data At Rest</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/file-output-policy.html">File Output Policy</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../import-export/database-import-export.html">Database Import/Export</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../backup-and-restore/backup-and-restore.html">Backup and Restore</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">REST API Reference</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../API/intro.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../API/built-in-endpoints.html">Built-in Endpoints</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../API/authentication.html">Authentication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../API/json-catalog.html">Built-in Endpoints JSON Catalog</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Troubleshooting</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../troubleshooting/faqs.html">Knowledge Base and FAQs</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../troubleshooting/system-administration-faqs.html">System Administration FAQs</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../troubleshooting/log-files.html">Log files</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../troubleshooting/troubleshooting-guide.html">Troubleshooting Guide</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Release Notes and Change Logs</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../release-notes/release-notes.html">Release Notes - TigerGraph Server 3.2</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../release-notes/change-log.html">Change Log</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../release-notes/v3.0-removal-of-previously-deprecated-features.html">V3.0 Removal of Previously Deprecated Features</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../legal/patents-and-third-party-software.html">Patents and Third Party Software</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">References</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/configuration-parameters.html">Configuration Parameters</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/error-codes.html">Error codes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/list-of-privileges.html">List of Privileges</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">TigerGraph Server</span>
    <span class="version">3.2</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../tigergraph-gui/3.2/graphstudio/overview.html">GraphStudio and Admin Portal</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../tigergraph-gui/3.2/graphstudio/overview.html">3.2</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../gsql-ref/3.2/intro/intro.html">GSQL Language Reference</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../gsql-ref/3.2/intro/intro.html">3.2</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../tigergraph-cloud/latest/start/README.html">TigerGraph Cloud</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../tigergraph-cloud/latest/start/README.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../tigergraph-data-science/3.2/intro/overview.html">TigerGraph Data Science Library</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../tigergraph-data-science/3.2/intro/overview.html">3.2</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../intro/introduction.html">TigerGraph Server</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../intro/introduction.html">3.2</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../intro/introduction.html">TigerGraph Server</a></li>
    <li><a href="README.html">User Access Management</a></li>
    <li><a href="vlac.html">Vertex-Level Access Control (Beta)</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/lennessyy/tg-server/edit/main/modules/user-access/pages/vlac.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Vertex-Level Access Control (Beta)</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Vertex-level Access Control (VLAC) allows database administrators to control data access on the vertex level by attaching tags to individual vertices on a graph (the base graph) and creating <em>tag-based graphs</em>. Tag-based graphs share the underlying data with the base graph but have their own sets of roles and privileges, which allows administrators to exercise fine-grained data access control without the vertex type boundary.</p>
</div>
<div class="paragraph">
<p>Figure 1 below illustrates two tag-based graphs built upon a base graph. The base graph contains vertices of <code>person</code> type, and vertices of <code>post</code> type. Two tags (A and B) are used to tag them. For example, vertex 1 and vertex 9 both have tag A. Vertex 3 and vertex 11 both have tag A and B. A tag-based graph named <code>tagA</code> will only present to its users those base graph vertices that have tag A (the bottom-left graph). The other tag-based graph named <code>tagB</code> will only present to its users those base graph vertices that have tag B (the bottom-right graph).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../.gitbook/assets/vlac-graphs-figure.png" alt="Figure 1. Tag-based graphs as subgraphs of a Base graph">
</div>
</div>
<div class="paragraph">
<p>For users operating on a tag-based graph, tags are an invisible aspect that silently filters how they load and query data. A tag-based graph defines its view, and all data outside its view is invisible to it.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sufficient privileges on the base graph or on the global scope are required to perform the steps described on this page.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ACCESS_TAG</code></p>
<div class="ulist">
<ul>
<li>
<p>Any operation involving tags</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>WRITE_SCHEMA</code></p>
<div class="ulist">
<ul>
<li>
<p>Create/run schema change jobs</p>
</li>
<li>
<p>Create tag-based graphs</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>READ_DATA, WRITE_DATA</code></p>
<div class="ulist">
<ul>
<li>
<p>Run queries that modify the graph</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>WRITE_LOADINGJOB</code>, <code>EXECUTE_LOADINGJOB</code></p>
<div class="ulist">
<ul>
<li>
<p>Create/run loading jobs</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_workflow_using_vertex_level_access_control"><a class="anchor" href="#_workflow_using_vertex_level_access_control"></a>Workflow - Using Vertex Level Access Control</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Below is the basic workflow on using the VLAC to control data access for a database administrator:</p>
</div>
<div class="sect2">
<h3 id="_1_create_a_tag_based_graph"><a class="anchor" href="#_1_create_a_tag_based_graph"></a><strong>1. Create a tag-based graph</strong></h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="vertex-level-access-control-beta.md#define-a-tag">Define tags</a>.</p>
</li>
<li>
<p><a href="vertex-level-access-control-beta.md#mark-vertex-types-as-taggable">Mark vertex types as taggable</a>.</p>
</li>
<li>
<p><a href="vertex-level-access-control-beta.md#create-a-tag-based-graph-1">Create a tag-based graph</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_2_manage_users_of_the_tag_based_graph"><a class="anchor" href="#_2_manage_users_of_the_tag_based_graph"></a><strong>2. Manage users of the tag-based graph</strong></h3>
<div class="ulist">
<ul>
<li>
<p>Grant built-in roles to users on a tag-based graph</p>
</li>
<li>
<p>Define roles and grant them to users on a tag-based graph</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_3_load_and_tag_data"><a class="anchor" href="#_3_load_and_tag_data"></a><strong>3. Load and tag data</strong></h3>
<div class="paragraph">
<p>There are three main options for tagging vertices.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="vertex-level-access-control-beta.md#add-tags-on-existing-data">Explicitly add/modify tags on existing data</a>: A user with the privilege <code>ACCESS_TAG</code> and <code>WRITE_DATA</code> privileges on the base graph can create and run a DML query that sets tags on selected individual vertices.</p>
</li>
<li>
<p><a href="vertex-level-access-control-beta.md#set-tags-explicitly-with-tags-clause">Explicitly set tags when loading data</a> into to a base graph: A user with <code>EXECUTE_LOADINGJOB</code> , <code>WRITE_LOADINGJOB</code> and <code>ACCESS_TAG</code> privileges on the base graph can create and run a loading job that explicitly sets tags on the newly loaded base graph vertices.</p>
</li>
<li>
<p><a href="vertex-level-access-control-beta.md#set-tags-implicitly-by-inserting-into-a-tag-based-graph">Implicitly set tags when loading into a tag-based graph</a>: A user with tag-based graph loading or insert privilege (e.g., a <code>designer</code> or <code>querywriter</code>) can create an ordinary loading or upsert job which inserts new vertices. The new vertices will be automatically tagged according to the tag-based graph&#8217;s schema definition.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_4_query_and_update_data"><a class="anchor" href="#_4_query_and_update_data"></a><strong>4. Query and update Data</strong></h3>
<div class="paragraph">
<p>Users with data read and write privileges (e.g., the <code>querywriter</code> and <code>queryreader</code> built-in roles) can query and update the tag-based graph as they would do any other graph. The data filtering for querying or data tagging for insertion is applied automatically.</p>
</div>
<div class="paragraph">
<p>The rest of this tutorial will first describe tag management: creating and dropping tags, making vertex type taggable, and using tags to define tag-based graphs. Next, the three ways to tag vertices are described and illustrated. We summarize the privilege scheme of tag-based graphs in terms of GSQL&#8217;s predefined roles. Finally, we give some use cases that can be solved by VLAC.</p>
</div>
<div class="paragraph">
<p>{% hint style="warning" %}
Features not yet supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DDL tag operations can only be done in GSQL. They are not yet supported in GraphStudio. This includes create/drop tags, create/alter vertices that are taggable, define a tag-based graph.</p>
</li>
<li>
<p>The privilege control for DDL operations (only admin and designer users should be able to explicitly manage tags) is not fully functional.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In summary, all necessary operations to set up VLAC graphs and users are supported in GSQL. Due to a known bug, standard users (with <code>querywriter</code> and <code>queryreader</code> roles) can run some DDL operations which they should not be able to.
{% endhint %}</p>
</div>
<div class="paragraph">
<p>We&#8217;ll use the graph <a href="../../../dev/gsql-ref/querying/appendix-query/example-graphs.md#socialnet">socialNet</a> as an example in the following sections.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tag_management"><a class="anchor" href="#_tag_management"></a>Tag Management</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A tag is a special attribute of a vertex, which appears as a string for input and output purposes. If a vertex type is declared to be <em>*taggable*</em>, then each vertex of that type can have one or more tags. The maximum number of different tags in a global graph is 64. All operations involving tags requires the user to have the <code>ACCESS_TAG</code> privilege.</p>
</div>
<div class="sect2">
<h3 id="_define_a_tag"><a class="anchor" href="#_define_a_tag"></a>Define a tag</h3>
<div class="paragraph">
<p>A tag name has to be defined via <code>ADD TAG</code> before it can be used. Each base graph defines its own set of tags. However, there is a global maximum number of different tags, currently set at 64.</p>
</div>
<div class="paragraph">
<p>{% code title="Syntax for ADD TAG" %}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-erlang hljs" data-lang="erlang">ADD TAG &lt;tag_name&gt; [DESCRIPTION &lt;tag_description&gt;]</code></pre>
</div>
</div>
<div class="paragraph">
<p>{% endcode %}</p>
</div>
<div class="paragraph">
<p><code>ADD TAG</code> can only be used inside a <code>SCHEMA_CHANGE JOB</code>. An example is below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-erlang hljs" data-lang="erlang">USE GRAPH socialNet

CREATE SCHEMA_CHANGE JOB add_tags {
  ADD TAG public DESCRIPTION "Open for public";
  ADD TAG tech DESCRIPTION "All about technology";
  ADD TAG vip DESCRIPTION "Very Important Person";
  ADD TAG dummy DESCRIPTION "Yeah, just a dummy";
}
RUN SCHEMA_CHANGE JOB add_tags</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_list_tags"><a class="anchor" href="#_list_tags"></a>List tags</h3>
<div class="paragraph">
<p>Run <code>ls</code> to see a list of defined tags:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-erlang hljs" data-lang="erlang">...

Tags:
- TAG public DESCRIPTION "Open for public"
- TAG tech DESCRIPTION "All about technology"
- TAG vip DESCRIPTION "Very Important Person"
- TAG dummy DESCRIPTION "Yeah, just a dummy"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drop_a_tag"><a class="anchor" href="#_drop_a_tag"></a>Drop a tag</h3>
<div class="paragraph">
<p>The <code>DROP TAG</code> command not only removes the given tag(s) from the catalog of available tags, but also deletes them from each vertex to which it is attached. You can drop multiple tags in one statement.</p>
</div>
<div class="paragraph">
<p>{% code title="Syntax for DROP TAG" %}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-erlang hljs" data-lang="erlang">DROP TAG &lt;tag_name&gt; ["," &lt;tag_name&gt;]*</code></pre>
</div>
</div>
<div class="paragraph">
<p>{% endcode %}</p>
</div>
<div class="paragraph">
<p>Like <code>ADD TAG</code>, <code>DROP TAG</code> also needs to be inside a <code>SCHEMA_CHANGE JOB</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-erlang hljs" data-lang="erlang">USE GRAPH socialNet

CREATE SCHEMA_CHANGE JOB drop_dummy_tag {
  DROP TAG dummy;
}
RUN SCHEMA_CHANGE JOB drop_dummy_tag</code></pre>
</div>
</div>
<div class="paragraph">
<p>{% hint style="info" %}</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>You cannot drop a tag if it is used in the definition of a tag-based graph. You must drop the graph first.</p>
</li>
<li>
<p>When <code>DROP TAG</code> is executed, the specified tags will be made invalid, and then the foreground process will complete. A background process will continue to run to remove the tags from all data. In the meantime, each dropped tag still takes up one of the 64 slots for tags. The slot(s) will become available once the background process finishes.
{% endhint %}</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_a_tag_based_graph"><a class="anchor" href="#_create_a_tag_based_graph"></a>Create a tag-based graph</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A tag-based graph is a filtered view of a base graph, where a base graph is a simple collection of vertex types and edge types, without any tag specifiers. A tag-based graph must include at least one <em>*taggable vertex type*</em> from the base graph.</p>
</div>
<div class="sect2">
<h3 id="_mark_vertex_types_as_taggable"><a class="anchor" href="#_mark_vertex_types_as_taggable"></a>Mark vertex types as taggable</h3>
<div class="paragraph">
<p>A vertex type has to be <em>*taggable*</em> to accept tags. <code>TAGGABLE</code> is a boolean property of a vertex type that can be set with <code>CREATE VERTEX</code> initially or with <code>ALTER VERTEX</code> in a schema change job:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-erlang hljs" data-lang="erlang">USE GRAPH socialNet

# in general, this would be a local schema change job, but in socialNet, the
# vertex types are global, so this needs to be a global schema change job
CREATE GLOBAL SCHEMA_CHANGE JOB make_taggable {
  ALTER VERTEX person WITH TAGGABLE="true";
  ALTER VERTEX post WITH TAGGABLE="true";
}

RUN GLOBAL SCHEMA_CHANGE JOB make_taggable</code></pre>
</div>
</div>
<div class="paragraph">
<p>The property TAGGABLE is false by default. To change this default, use the <code>WITH</code> clause below when creating a vertex type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-erlang hljs" data-lang="erlang">CREATE VERTEX v2(PRIMARY_ID id UINT, name STRING) WITH TAGGABLE="true"</code></pre>
</div>
</div>
<div class="paragraph">
<p>{% hint style="info" %}</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>To change a vertex type from taggable to untaggable, use <code>WITH TAGGABLE="false".</code></p>
</li>
<li>
<p>You cannot make a vertex type untaggable if it is used in the definition of a tag-based graph.</p>
</li>
<li>
<p>Edge types are never tagged. See the next section to see how we determine which edges to include in the tag-based graph.
{% endhint %}</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_create_a_tag_based_graph_2"><a class="anchor" href="#_create_a_tag_based_graph_2"></a>Create a Tag-Based Graph</h3>
<div class="paragraph">
<p>After a tag set and taggable vertex types have been created, we can use the tags to define a tag-based graph. For each vertex type we want to include, we may also specify a tag expression which must be satisfied for an individual vertex to be included.</p>
</div>
<div class="paragraph">
<p><strong>Examples</strong></p>
</div>
<div class="paragraph">
<p>Here is an example of creating a tag-based graph from the base graph <code>socialNet</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-erlang hljs" data-lang="erlang">USE GRAPH socialNet
CREATE GRAPH vipNet AS socialNet(person:vip, post, friend, posted, liked)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The interpretation is "Starting from the <code>socialNet</code> graph, create a tag-based graph called <code>vipNet</code> which includes <code>person</code> vertices which are tagged '<code class="code">vip</code>'. Also include all <code>post</code> vertices and all <code>friend</code>, <code>posted</code> and <code>liked</code> edges."</p>
</div>
<div class="paragraph">
<p>Edges do not have tag expressions. An edge will be included when both of its vertex endpoints are included (and its edge type is included in the tag graph schema).</p>
</div>
<div class="paragraph">
<p>To describe a combination of tags, use the <code>&amp;</code> operator to combine the tags:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-erlang hljs" data-lang="erlang">USE GRAPH socialNet
CREATE GRAPH mixedNet AS socialNet(person:public&amp;vip, post:public&amp;tech&amp;dummy, friend, posted, liked)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The graph <code>mixedNet</code> will only include the <code>person</code> vertices having both the <code>public</code> and <code>vip</code>tags, and posts having all three of the <code>public</code> , <code>tech</code> and <code>dummy</code> tags.</p>
</div>
<div class="paragraph">
<p><strong>Same tag for all vertex types</strong></p>
</div>
<div class="paragraph">
<p>If the desired tag-based graph is "anything in the base graph that has these tags", there is a convenient shortcut:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-erlang hljs" data-lang="erlang">USE GRAPH socialNet
CREATE GRAPH publicNet2 AS socialNet:public</code></pre>
</div>
</div>
<div class="paragraph">
<p>is the same as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-erlang hljs" data-lang="erlang">USE GRAPH socialNet
CREATE GRAPH publicNet1 AS socialNet(person:public, post:public, friend, posted, liked)</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>General Syntax</strong></p>
</div>
<div class="paragraph">
<p>The formal syntax for both the general form and the simplified form of creating a tag-based graph is shown below:</p>
</div>
<div class="paragraph">
<p>{% code title="Syntax for CREATE GRAPH for a tag-based graph" %}</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-erlang hljs" data-lang="erlang">&lt;create_tag_graph&gt; :=
    CREATE GRAPH &lt;tag_graph_name&gt; AS &lt;base_graph_name&gt;
    ( "(" &lt;tagged_element_name&gt; ("," &lt;tagged_element_name&gt;)* ")" | ":" &lt;tag_expr&gt; )

&lt;tagged_element_name&gt; := &lt;tagged_vertex_name&gt; | &lt;edge_name&gt;

&lt;tagged_vertex_name&gt; := &lt;vertex_name&gt; [":" &lt;tag_expr&gt;]

&lt;tag_expr&gt; := &lt;tag&gt; ("&amp;" &lt;tag_expr&gt;)*</code></pre>
</div>
</div>
<div class="paragraph">
<p>{% endcode %}</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_tag_vertices"><a class="anchor" href="#_how_to_tag_vertices"></a>How To Tag Vertices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are three main options for tagging vertices in the base graph.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Add tags on existing data with DML queries.</strong> For existing data, a user with base graph tagging privilege (e.g., an <code>admin</code> or <code>designer</code>) can create and run a DML query that sets tags on selected individual vertices.</p>
</li>
<li>
<p><strong>Explicitly set tags when loading/inserting to a base graph</strong>. For new data, a user with base graph loading and tagging privilege (e.g., an <code>admin</code> or <code>designer</code>) can create and run a loading job that explicitly sets tags on the newly loaded vertices.</p>
</li>
<li>
<p><strong>Implicitly set tags when loading/inserting into a tag-based graph</strong>.  For new data, a user with tag-based graph loading or insert privilege (e.g., a <code>designer</code> or <code>querywriter</code>) can create an ordinary Loading or Upsert Job which inserts new vertices. The new vertices will be automatically tagged according to the tag-based graph&#8217;s schema definition.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_add_tags_on_existing_data"><a class="anchor" href="#_add_tags_on_existing_data"></a>Add tags on existing data</h3>
<div class="paragraph">
<p>In GSQL, special vertex methods are provided to access and modify the tags of a vertex in a DML query (full list available on page <a href="../../../dev/gsql-ref/querying/func/vertex-methods.md#vlac-vertex-alias-methods">Vertex Functions</a>).  These functions are only available for vertex aliases (defined in the <code>FROM</code> clause of a <code>SELECT</code> statement); they cannot be applied to vertex variables in other contexts.</p>
</div>
<div class="paragraph">
<p>There are <a href="#../reference/vertex-level-access-control-functions.adoc" class="page unresolved">8 DML-level tag-access functions</a> in the vertex-query block or edge-query block. Use the <a href="../reference/reference.md#addtags-string-tag-1-string-tagn"><code>v.addTags()</code></a> function to tag a vertex.</p>
</div>
<div class="sect3">
<h4 id="_required_privilege"><a class="anchor" href="#_required_privilege"></a>Required privilege</h4>
<div class="paragraph">
<p><code>READ_DATA</code>, <code>WRITE_DATA</code>, <code>WRITE_QUERY</code> , <code>ACCESS_TAG</code></p>
</div>
<div class="paragraph">
<p>{% hint style="info" %}
To add or modify tags, you should work at the base graph level.
{% endhint %}</p>
</div>
<div class="paragraph">
<p><strong>Examples</strong></p>
</div>
<div class="paragraph">
<p><code>addTags()</code> is shown below. This query will add tags to person vertices to achieve the same effect as a base graph loading job example in the previous section.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">CREATE QUERY addTagsToPerson() {
  Seed = { any };
  # person1 ~ person5 will be tagged as public.
  vSet = SELECT s
         FROM Seed:s
         WHERE s.id IN ("person1","person2","person3","person4","person5")
         ACCUM s.addTags("public");

  # person6 and person7 will be tagged as public and vip.
  vSet = SELECT s
         FROM Seed:s
         WHERE s.id IN ("person6","person7")
         ACCUM s.addTags("vip", "public");

  # person8 will be tagged as vip
  vSet = SELECT s
         FROM Seed:s
         WHERE s.id == "person8"
         ACCUM s.addTags("vip");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use <a href="../reference/vertex-level-access-control-functions.md#removetags-string-tag-1-string-tagn"><code>removeTags()</code></a> and <a href="../reference/vertex-level-access-control-functions.md#removealltags"><code>removeAllTags()</code></a> to remove tags from vertices:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-erlang hljs" data-lang="erlang">// remove tag “vip” and “public” from all person vertices.
CREATE QUERY removetagsFromPerson() {
  vSet = { person.* };
  # remove tag vip and public from all person vertices
  vSet = SELECT s
         FROM vSet:s
         ACCUM s.removeTags("vip", "public");
}

// remove all tags from all person vertices.
CREATE QUERY removealltagsFromPerson() {
  vSet = { person.* };
  # remove all tags from all person vertices
  vSet = SELECT s
         FROM vSet:s
         ACCUM s.removeAllTags();
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_set_tags_explicitly_with_tags_clause"><a class="anchor" href="#_set_tags_explicitly_with_tags_clause"></a>Set tags explicitly with <code>TAGS</code> clause</h3>
<div class="paragraph">
<p>Tags can be added to vertices at their loading time using a base graph loading job.</p>
</div>
<div class="paragraph">
<p>The <code>LOAD</code> statement has an optional clause for explicit tagging of loaded data. The tagging clause has two keywords, <code>TAGS</code> and <code>BY:</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>TAGS(&lt;tag_list&gt;)</code> specifies the tags to be set.</p>
</li>
<li>
<p><code>BY</code> specifies how to merge tags if the targeted vertex exists in the graph</p>
<div class="ulist">
<ul>
<li>
<p><code>BY OR:</code>Add the given tags to the existing set of tags.</p>
</li>
<li>
<p><code>BY OVERWRITE:</code> Replace the existing tags with the given ones.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_required_privilege_2"><a class="anchor" href="#_required_privilege_2"></a>Required privilege</h4>
<div class="paragraph">
<p><code>WRITE_LOADINGJOB</code> , <code>EXECUTE_LOADINGJOB</code>, <code>ACCESS_TAG</code></p>
</div>
<div class="paragraph">
<p><strong>Example 1</strong></p>
</div>
<div class="paragraph">
<p>Suppose we want to put the tags <code>vip</code> and <code>public</code> on the <code>person</code> vertex data coming from a certain file. We have three files: <code>persons1</code>, <code>persons2</code>, <code>persons3</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-erlang hljs" data-lang="erlang">$ cat persons1
person1,Male
person2,Female
person3,Male
person4,Female
person5,Female

$ cat persons2
person6,Male
person7,Male

$ cat persons3
id,gender,label
person8,Male,vip</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create and run three loading jobs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">USE GRAPH socialNet

# person1 - person5 will be tagged as public.
CREATE LOADING JOB loadPersonPublic {
  DEFINE filename f;
  LOAD f TO VERTEX person VALUES($0, $0, $1) TAGS("public") BY OR;
}
RUN LOADING JOB loadPersonPublic USING f="./persons1"

# person6 and person7 will be tagged as public and vip.
CREATE LOADING JOB loadPersonPublicVip {
  DEFINE filename f;
  LOAD f TO VERTEX person VALUES($0, $0, $1) TAGS("public", "vip") BY OR;
}
RUN LOADING JOB loadPersonPublicVip USING f="./persons2"

# person8 will be tagged as vip which is derived from the file.
CREATE LOADING JOB loadPerson {
  DEFINE filename f;
  LOAD f TO VERTEX person VALUES($0, $0, $1) TAGS($2) BY OR USING HEADER="true";
}
RUN LOADING JOB loadPerson USING f="./persons3"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>TAGS</code> clause can specify a tag with a string literal (<code>"vip"</code>) so every vertex gets the same tag, or with a token reference by position (<code>$2</code>) or by name (<code>$"label"</code>) from the source file, so each vertex gets a data-dependent tag. If the tag clause refers to a non-existent tag, the loading job will still run, but the data will not be loaded at runtime. The loading job log will report these non-loaded vertices.</p>
</div>
<div class="paragraph">
<p><strong>Example 2</strong></p>
</div>
<div class="paragraph">
<p>We have three post files: <code>posts1</code>, <code>posts2</code>, and <code>posts3</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-erlang hljs" data-lang="erlang">$ cat posts1
3,cats,2011-02-05 01:02:44
8,cats,2011-02-03 17:05:52
9,cats,2011-02-05 23:12:42
10,cats,2011-02-04 03:02:31
11,cats,2011-02-03 01:02:21

$ cat posts2
4,coffee,2011-02-07 05:02:51

$ cat posts3
0,Graphs,2010-01-12 11:22:05
1,tigergraph,2011-03-03 23:02:00
2,query languages,2011-02-03 01:02:42
5,tigergraph,2011-02-06 01:02:02
6,tigergraph,2011-02-05 02:02:05
7,Graphs,2011-02-04 17:02:41</code></pre>
</div>
</div>
<div class="paragraph">
<p>We create and run the following loading jobs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">USE GRAPH socialNet

# posts 3, 8, 9, 10, and 11 will be tagged as public.
CREATE LOADING JOB loadPostPublic {
  DEFINE filename f;
  LOAD f TO VERTEX post VALUES($0, $1, $2) TAGS("public") BY OR ;
}
RUN LOADING JOB loadPostPublic USING f="./posts1"

# posts 0, 1, 2, 5, 6, and 7 will be tagged as both public and tech.
CREATE LOADING JOB loadPostPublicTech {
  DEFINE filename f;
  LOAD f TO VERTEX post VALUES($0, $1, $2) TAGS("public", "tech") BY OR;
}
RUN LOADING JOB loadPostPublicTech USING f="./posts3"

# post 4 will remain untagged.</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_set_tags_implicitly_by_inserting_into_a_tag_based_graph"><a class="anchor" href="#_set_tags_implicitly_by_inserting_into_a_tag_based_graph"></a><strong>Set tags implicitly by inserting into a tag-based graph</strong></h3>
<div class="paragraph">
<p>Loading data to a tag-based graph automatically tags each vertex with the tags specified in the graph&#8217;s definition. For example, when loading to <code>vipNet</code>, the <code>person</code> vertices will automatically be tagged with <code>vip</code>.</p>
</div>
<div class="paragraph">
<p>If you load data into a tag-based graph, these vertices are actually being added to the parent base graph. If two tag-based graphs have overlapping views (e.g. if the graph <code>vipNet2</code> also includes <code>person:vip</code>), then when one adds a vertex via the tag-based graph, the other tag-based graph may also see it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-erlang hljs" data-lang="erlang">USE GRAPH vipNet

CREATE LOADING JOB loadMember {
  DEFINE filename f;
  // TAGS("vip") BY OR will be applied implicitly
  // since vipNet is defined based on person:vip
  LOAD f TO VERTEX person VALUES($0, $0, $1);
}
RUN LOADING JOB loadMember USING f="./persons3"</code></pre>
</div>
</div>
<div class="paragraph">
<p>{% hint style="info" %}</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Portability and Reusability</strong>: The same loading job works for <code>socialNet</code> or any graph derived from <code>socialNet</code> which contains <code>person</code>. The difference is in the effect: running it with <code>vipNet</code> will apply the <code>vip</code> tag. Running it with a different tag-based graph would apply different tags. <em>Users of a given tag-based graph automatically insert and query data for that tag-based graph.</em></p>
</li>
<li>
<p><strong>Tagging Shared Data</strong>: The default behavior of GSQL loading is upsert: if you attempt to <strong>insert</strong> a vertex or edge which already exists (e.g., uses an existing ID), you will instead <strong>update</strong> the existing element with the new attribute values. If the attribute is a list or set, the new values will be added to the existing list/set.  This applies to tags. If you attempt to load an existing vertex, the new tag(s) will be added to any existing tags. <em>Loading a vertex that already exists extends the tag set with the guidance of the tag-graph schema.</em>
{% endhint %}</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_query_a_tag_based_graph"><a class="anchor" href="#_query_a_tag_based_graph"></a>Query a Tag-based Graph</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The graph <code>vipNet</code> only includes vertices with the tag <code>vip</code>. We can verify this by running a simple query to return all person vertices in <code>vipNet</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-erlang hljs" data-lang="erlang">USE GRAPH vipNet

CREATE QUERY findAll() {
  seed = {person.*};
  result =
    SELECT v
    FROM seed:v
    ORDER BY v.id;

  PRINT result;
}
INSTALL QUERY findAll
RUN QUERY findAll()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output of the query would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-erlang hljs" data-lang="erlang">{
  "error": false,
  "message": "",
  "version": {
    "schema": 2,
    "edition": "enterprise",
    "api": "v2"
  },
  "results": [{"res": [
    {
      "v_id": "person6",
      "attributes": {
        "gender": "Male",
        "id": "person6"
      },
      "v_type": "person"
    },
    {
      "v_id": "person7",
      "attributes": {
        "gender": "Male",
        "id": "person7"
      },
      "v_type": "person"
    },
    {
      "v_id": "person8",
      "attributes": {
        "gender": "Male",
        "id": "person8"
      },
      "v_type": "person"
    }
  ]}]
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_access_control"><a class="anchor" href="#_access_control"></a>Access Control</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Users with global <code>WRITE_SCHEMA</code> and <code>ACCESS_TAG</code> privileges can create, modify and drop tags, as well as create tag-based graphs for all graphs.</p>
</div>
<h4 id="_on_the_base_graph" class="discrete">On the base graph</h4>
<div class="paragraph">
<p>Users with roles on the base graph that have the <code>ACCESS_TAG</code> privilege (e.g.<code>admin</code> and <code>designer</code> roles) can create/drop tags, and tag vertices. Users that have both the <code>ACCESS_TAG</code> privilege and <code>WRITE_SCHEMA</code> privilege (e.g. <code>admin</code> and <code>designer</code> roles) can create/drop tag-based graphs of the base graph.</p>
</div>
<div class="paragraph">
<p>Users with roles that don&#8217;t have the <code>ACCESS_TAG</code> privilege on the base graph are able to access the base graph as their roles allow, but they do not have access to the tags on the base graph. They cannot see whether any vertex type on the graph is taggable or if there are tag-based graphs of the base graph.</p>
</div>
<div class="paragraph">
<p>Users with roles on the tag-based graphs of the base graph cannot access the base graph if they don&#8217;t have a role with privileges for the base graph.</p>
</div>
<h4 id="_on_tag_based_graphs" class="discrete">On tag-based graphs</h4>
<div class="paragraph">
<p>When a new tag-based graph is created, users with <code>admin</code> or <code>designer</code> roles will inherit their base graph role on the tag-based graph. Additionally, the creator of the tag-based graph becomes an admin of the tag-based graph.</p>
</div>
<div class="paragraph">
<p>Users who are given roles on a tag-based graph have the privileges on the tag-based graph that correspond to their roles, except they are not allowed to edit the tag-based graph&#8217;s graph schema.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sample_use_cases"><a class="anchor" href="#_sample_use_cases"></a>Sample Use Cases</h2>
<div class="sectionbody">
<h4 id="_scenario_i" class="discrete"><strong>Scenario I</strong></h4>
<div class="paragraph">
<p><strong>Problem</strong></p>
</div>
<div class="paragraph">
<p>A user with <code>admin</code> role on a graph wants to grant a group of users access to a selective set of vertices.</p>
</div>
<div class="paragraph">
<p><strong>Solution</strong></p>
</div>
<div class="paragraph">
<p>The base graph admin can do the following security setup.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Define a tag</strong>. In a schema change job, <a href="vertex-level-access-control.md#define-a-tag">declare a tag</a> <code>T</code> for this application.</p>
</li>
<li>
<p><strong>Mark vertex types as taggable</strong>. Identify the vertex types you want to give selective access for, and <a href="vertex-level-access-control.md#taggable-vertex-types">mark those vertex types as taggable</a> in a schema change job.</p>
</li>
<li>
<p><strong>Define a tag-based graph</strong>. <a href="vertex-level-access-control.md#create-a-tag-based-graph">Define a tag-based graph</a> <code>B</code> with the taggable vertex types, with <code>T</code> as their tag expression.</p>
</li>
<li>
<p><strong>Tag vertices</strong>. Write a DML query on the base graph and use the tag functions in the query to <a href="vertex-level-access-control.md#Use-tag-functions-in-a-DML-query-to-update-base-graph-vertices">tag the vertices</a> you want to include in the tag-based graph, and run the query.</p>
</li>
<li>
<p><strong>Grant users permission to the tag-based graph</strong>. On the tag-based graph B, grant roles that have the appropriate privileges for graph <code>B</code> to the target users.</p>
</li>
</ol>
</div>
<h4 id="_scenario_ii" class="discrete"><strong>Scenario II</strong> <a id="Scenario-II:-Before-you-ingest-a-source-file-to-a-base-graph,-you-can-derive-tags(classes)-of-each-vertex-type.-You-want-to-grant-a-group-of-users-access-permissions-based-on-the-vertex-tags."></a></h4>
<div class="paragraph">
<p><strong>Problem</strong></p>
</div>
<div class="paragraph">
<p>You have a source file containing class annotations (tags) on vertex data. You want to grant users access to the vertices that have the annotation <code>T1</code>. In the future, you also want the ability to give other users access to vertices based on the vertex class.</p>
</div>
<div class="paragraph">
<p><strong>Solution</strong></p>
</div>
<div class="paragraph">
<p>The base graph <code>admin</code> user can do the following setup.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Define tags</strong>. <a href="vertex-level-access-control.md#define-a-tag">Declare tags</a> <code>T1, T2, … Tn</code> for all the classes in your source file in a schema change job.</p>
</li>
<li>
<p><strong>Mark vertex types as taggable</strong>. Identify the vertex types of the vertices in your source file that have class annotations, and<a href="vertex-level-access-control.md#taggable-vertex-types">mark those vertex types as taggable</a> in a schema change job.</p>
</li>
<li>
<p><strong>Define a tag-based graph</strong>.<a href="vertex-level-access-control.md#create-a-tag-based-graph">Define a tag-based graph</a> <code>B</code> with <code>T1</code> as the tag expression.</p>
</li>
<li>
<p><strong>Explicitly tag vertices during data loading</strong>. Write a base graph loading job, and in the loading job, use a <code>TAGS() BY</code> clause to <a href="vertex-level-access-control.md#set-tags-explicitly-during-data-loading">explicitly add tags</a> to the ingested vertices.</p>
</li>
<li>
<p><strong>Grant roles on the tag-based graph</strong>. On the tag-based graph <code>B</code>, grant roles that have the appropriate privileges for the graph <code>B</code> to target users.</p>
</li>
</ol>
</div>
<h4 id="_scenario_iii" class="discrete"><strong>Scenario III</strong> <a id="Scenario-III:-A-base-graph-admin-want-to-give-read/write-access-to-a-group-of-user-who-only-generate-a-class-of-vertices."></a></h4>
<div class="paragraph">
<p><strong>Problem</strong></p>
</div>
<div class="paragraph">
<p>An <code>admin</code> user on a graph wants to give a group of users read/write access for a specific class of vertices. The users would be able to insert new vertices into the graph and query the data, and all the data they insert into the graph are tagged as the same class.</p>
</div>
<div class="paragraph">
<p><strong>Solution</strong></p>
</div>
<div class="paragraph">
<p>The base graph admin can do the following setup.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Define a tag</strong>. <a href="vertex-level-access-control.md#define-a-tag">Declare a tag</a> <code>T</code> for this application in a schema change job.</p>
</li>
<li>
<p><strong>Mark vertex types as taggable</strong>. Identify the vertex types to give selective access to, and <a href="vertex-level-access-control.md#taggable-vertex-types">mark the relevant vertex types as taggable</a> in a schema change job.</p>
</li>
<li>
<p><strong>Define a tag-based graph</strong>. <a href="vertex-level-access-control.md#create-a-tag-based-graph">Define a tag-based graph</a> <code>B</code> with <code>T</code> as the tag expression.</p>
</li>
<li>
<p><strong>Grant roles on the tag-based graph</strong>. On the tag-based graph, grant roles with the appropriate privileges to target users.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These group users operate (including delete/update/insert) on graph <code>B</code> as if it is a normal graph. They can ingest new data, as well as operate on those vertices from the base graph that have the tag <code>T</code>.</p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
